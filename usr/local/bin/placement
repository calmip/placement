#! /bin/bash

dir=$(dirname $0)

export PYTHONPATH=$(cd $dir;cd ../lib/placement; pwd -P)

placement="$0.py"

if [[ $1 == "--jobid" ]]
then
	shift
	job_id=$1
	shift
    PN=$( squeue -j $job_id --noheader -o "%.9P@%.16R" )
	[[ $PN =~ (.*)@(.*) ]]

	# P = partition, N = nodeset
	P=${BASH_REMATCH[1]}
	N=${BASH_REMATCH[2]}
	
	for n in $(nodeset -e $N)
	do
		ssh $n export PLACEMENT_ARCHI=\"$P\" \; $0 $*
	done
else
    exec $placement $*
fi

